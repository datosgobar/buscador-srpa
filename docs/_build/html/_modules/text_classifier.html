<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="es">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>text_classifier &#8212; documentación de text-classifier - 0.01</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.01',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="documentación de text-classifier - 0.01" href="../index.html" />
    <link rel="up" title="Código de módulo" href="index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Código fuente para text_classifier</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="sd">u&quot;&quot;&quot;Módulo de clasificación de textos.</span>

<span class="sd">Este módulo contiene a los objetos que permiten entrenar un clasificador</span>
<span class="sd">automático de textos y pedir sugerencias de textos similares.</span>

<span class="sd">Example:</span>
<span class="sd">    Examples can be given using either the ``Example`` or ``Examples``</span>
<span class="sd">    sections. Sections support any reStructuredText formatting, including</span>
<span class="sd">    literal blocks::</span>

<span class="sd">        $ python example_google.py</span>
<span class="sd">Todo:</span>
<span class="sd">    * For module TODOs</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">unicode_literals</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="k">import</span> <span class="n">CountVectorizer</span><span class="p">,</span> <span class="n">TfidfTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics.pairwise</span> <span class="k">import</span> <span class="n">pairwise_distances</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="k">import</span> <span class="n">SGDClassifier</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">sparse</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">warnings</span>


<div class="viewcode-block" id="TextClassifier"><a class="viewcode-back" href="../index.html#text_classifier.TextClassifier">[documentos]</a><span class="k">class</span> <span class="nc">TextClassifier</span><span class="p">():</span>

    <span class="sd">u&quot;&quot;&quot;Clasificador automático de textos.</span>

<span class="sd">    Usa TF-IDF para vectorizar.</span>
<span class="sd">    Usa SVM para clasificar.</span>
<span class="sd">    Usa Ball-Tree para devolver vecinos cercanos.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        attr1 (str): Description of `attr1`.</span>
<span class="sd">        attr2 (:obj:`int`, optional): Description of `attr2`.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">texts</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">vocabulary</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Definido en la declaracion de la clase.</span>

<span class="sd">        Attributes:</span>
<span class="sd">            attr1 (str): Description of `attr1`.</span>
<span class="sd">            attr2 (:obj:`int`, optional): Description of `attr2`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">es_stopwords</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">&#39;ES_stopwords.txt&#39;</span><span class="p">,</span>
                                   <span class="n">header</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">es_stopwords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">es_stopwords</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_id_length</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="s">&#39;content&#39;</span><span class="p">,</span> <span class="n">ngram_range</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                                          <span class="n">min_df</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">stop_words</span><span class="o">=</span><span class="n">es_stopwords</span><span class="p">,</span>
                                          <span class="n">vocabulary</span><span class="o">=</span><span class="n">vocabulary</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span> <span class="o">=</span> <span class="n">TfidfTransformer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">term_mat</span> <span class="o">=</span> <span class="k">None</span>  <span class="c"># Matriz que cuenta los terminos en un texto.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tfidf_mat</span> <span class="o">=</span> <span class="k">None</span>  <span class="c"># Matriz de relevancia de los terminos.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reload_texts</span><span class="p">(</span><span class="n">texts</span><span class="p">,</span> <span class="n">ids</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;Representacion en str del objeto.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

<div class="viewcode-block" id="TextClassifier.make_classifier"><a class="viewcode-back" href="../index.html#text_classifier.TextClassifier.make_classifier">[documentos]</a>    <span class="k">def</span> <span class="nf">make_classifier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Entrenar un clasificador SVM sobre los textos cargados.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Nombre para el clasidicador.</span>
<span class="sd">            ids (list): Se espera una lista de N ids de textos ya almacenados</span>
<span class="sd">                en el TextClassifier.</span>
<span class="sd">            labels (list): Se espera una lista de N etiquetas. Una por cada id</span>
<span class="sd">                de texto presente en ids.</span>
<span class="sd">        Nota:</span>
<span class="sd">            Usa el clasificador de `Scikit-learn &lt;http://scikit-learn.org/&gt;`_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Hay ids de textos que no se encuentran </span><span class="se">\</span>
<span class="s">                              almacenados.&quot;</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">SGDClassifier</span><span class="p">())</span>
        <span class="n">classifier</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">,</span> <span class="n">ids</span><span class="p">)</span>
        <span class="n">classifier</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tfidf_mat</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="p">:],</span> <span class="n">labels</span><span class="p">)</span></div>

<div class="viewcode-block" id="TextClassifier.retrain"><a class="viewcode-back" href="../index.html#text_classifier.TextClassifier.retrain">[documentos]</a>    <span class="k">def</span> <span class="nf">retrain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reentrenar parcialmente un clasificador SVM.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Nombre para el clasidicador.</span>
<span class="sd">            ids (list): Se espera una lista de N ids de textos ya almacenados</span>
<span class="sd">                en el TextClassifier.</span>
<span class="sd">            labels (list): Se espera una lista de N etiquetas. Una por cada id</span>
<span class="sd">                de texto presente en ids.</span>
<span class="sd">        Nota:</span>
<span class="sd">            Usa el clasificador de `Scikit-learn &lt;http://scikit-learn.org/&gt;`_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Hay ids de textos que no se encuentran </span><span class="se">\</span>
<span class="s">                              almacenados.&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">classifier</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&quot;No hay ningun clasificador con ese nombre.&quot;</span><span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">,</span> <span class="n">ids</span><span class="p">)</span>
        <span class="n">classifier</span><span class="o">.</span><span class="n">partial_fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tfidf_mat</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="p">:],</span> <span class="n">labels</span><span class="p">)</span></div>

<div class="viewcode-block" id="TextClassifier.classify"><a class="viewcode-back" href="../index.html#text_classifier.TextClassifier.classify">[documentos]</a>    <span class="k">def</span> <span class="nf">classify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classifier_name</span><span class="p">,</span> <span class="n">examples</span><span class="p">,</span> <span class="n">max_labels</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
                 <span class="n">goodness_of_fit</span><span class="o">=</span><span class="k">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Usar un clasificador SVM para etiquetar textos nuevos.</span>

<span class="sd">        Args:</span>
<span class="sd">            classifier_name (str): Nombre del clasidicador a usar.</span>
<span class="sd">            examples (list or str): Se espera un ejemplo o una lista de</span>
<span class="sd">                ejemplos a clasificar en texto plano o en ids.</span>
<span class="sd">            max_labels (int, optional): Cantidad de etiquetas a devolver para</span>
<span class="sd">                cada ejemplo. Si se devuelve mas de una el orden corresponde a</span>
<span class="sd">                la plausibilidad de cada etiqueta. Si es None devuelve todas</span>
<span class="sd">                las etiquetas posibles.</span>
<span class="sd">            goodness_of_fit (bool, optional): Indica si devuelve o no una</span>
<span class="sd">                medida de cuan buenas son las etiquetas.</span>
<span class="sd">        Nota:</span>
<span class="sd">            Usa el clasificador de `Scikit-learn &lt;http://scikit-learn.org/&gt;`_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">classifier</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classifier_name</span><span class="p">)</span>
        <span class="n">texts_vectors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_text_vectors</span><span class="p">(</span><span class="n">examples</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">classifier</span><span class="o">.</span><span class="n">classes_</span><span class="p">,</span> <span class="n">classifier</span><span class="o">.</span><span class="n">decision_function</span><span class="p">(</span><span class="n">texts_vectors</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_make_text_vectors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">examples</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Funcion para generar los vectores tf-idf de una lista de textos.</span>

<span class="sd">        Args:</span>
<span class="sd">            examples (list or str): Se espera un ejemplo o una lista de:</span>
<span class="sd">                o bien ids, o bien textos.</span>
<span class="sd">        Returns:</span>
<span class="sd">            textvec (sparse matrix): Devuelve una matriz sparse que contiene</span>
<span class="sd">                los vectores TF-IDF para los ejemplos que se pasan de entrada.</span>
<span class="sd">                El tamaño de la matriz es de (N, T) donde N es la cantidad de</span>
<span class="sd">                ejemplos y T es la cantidad de términos en el vocabulario.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">examples</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">examples</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">:</span>
                <span class="n">textvec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tfidf_mat</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ids</span> <span class="o">==</span> <span class="n">examples</span><span class="p">,</span> <span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">textvec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer</span><span class="o">.</span><span class="n">transform</span><span class="p">([</span><span class="n">examples</span><span class="p">])</span>
                <span class="n">textvec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">textvec</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">textvec</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">examples</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">examples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">)):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tfidf_mat</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">,</span> <span class="n">examples</span><span class="p">)]</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">examples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">)):</span>
                <span class="n">textvec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">examples</span><span class="p">)</span>
                <span class="n">textvec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">textvec</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">textvec</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Las listas de ejemplos deben ser todos ids</span><span class="se">\</span>
<span class="s">                                  de textos almacenados o todos textos planos&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Los ejemplos no son del tipo de dato adecuado.&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="TextClassifier.get_similar"><a class="viewcode-back" href="../index.html#text_classifier.TextClassifier.get_similar">[documentos]</a>    <span class="k">def</span> <span class="nf">get_similar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">example</span><span class="p">,</span> <span class="n">max_similars</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">similarity_cutoff</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Devuelve textos similares al ejemplo dentro de los textos entrenados.</span>

<span class="sd">        Nota:</span>
<span class="sd">            Usa la distancia de coseno del vector de features TF-IDF</span>

<span class="sd">        Args:</span>
<span class="sd">            example (str): Se espera un id de texto o un texto a partir del</span>
<span class="sd">                cual se buscaran otros textos similares.</span>
<span class="sd">            max_similars (int, optional): Cantidad de textos similares a</span>
<span class="sd">                devolver.</span>
<span class="sd">            similarity_cutoff (float, optional): Valor umbral de similaridad</span>
<span class="sd">                para definir que dos textos son similares entre si.</span>
<span class="sd">        Returns:</span>
<span class="sd">            text_ids (list of str): Devuelve los ids de los textos sugeridos.</span>
<span class="sd">            sorted_dist (list of float): Devuelve la distancia entre las</span>
<span class="sd">                opciones sugeridas y el ejemplo dado como entrada.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">max_similars</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">term_mat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;No se pueden pedir mas sugerencias que la </span><span class="se">\</span>
<span class="s">                              cantidad de textos que hay almacenados.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">example</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span> <span class="o">==</span> <span class="n">example</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tfidf_mat</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">pairwise_distances</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tfidf_mat</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
            <span class="c"># Pongo la distancia a si mismo como inf, par que no se devuelva a</span>
            <span class="c"># si mismo como una opcion</span>
            <span class="n">distances</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer</span><span class="o">.</span><span class="n">transform</span><span class="p">([</span><span class="n">example</span><span class="p">])</span>  <span class="c"># contar terminos</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>  <span class="c"># calcular tfidf</span>
            <span class="n">distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">pairwise_distances</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tfidf_mat</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="n">sorted_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>
        <span class="n">closest_n</span> <span class="o">=</span> <span class="n">sorted_indices</span><span class="p">[:</span><span class="n">max_similars</span><span class="p">]</span>
        <span class="n">sorted_dist</span> <span class="o">=</span> <span class="n">distances</span><span class="p">[</span><span class="n">closest_n</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">similarity_cutoff</span><span class="p">:</span>
            <span class="n">closest_n</span> <span class="o">=</span> <span class="n">closest_n</span><span class="p">[</span><span class="n">sorted_dist</span> <span class="o">&lt;</span> <span class="n">similarity_cutoff</span><span class="p">]</span>
        <span class="n">text_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">closest_n</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">text_ids</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">sorted_dist</span><span class="p">)</span></div>

<div class="viewcode-block" id="TextClassifier.reload_texts"><a class="viewcode-back" href="../index.html#text_classifier.TextClassifier.reload_texts">[documentos]</a>    <span class="k">def</span> <span class="nf">reload_texts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">texts</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">vocabulary</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calcula los vectores de terminos de textos y los almacena.</span>

<span class="sd">        A diferencia de :func:`~TextClassifier.TextClassifier.store_text` esta</span>
<span class="sd">        funcion borra cualquier informacion almacenada y comienza el conteo</span>
<span class="sd">        desde cero. Se usa para redefinir el vocabulario sobre el que se</span>
<span class="sd">        construyen los vectores.</span>

<span class="sd">        Args:</span>
<span class="sd">            texts (list): Una lista de N textos a incorporar.</span>
<span class="sd">            ids (list): Una lista de N ids alfanumericos para los textos.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_id_length</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vocabulary</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer</span><span class="o">.</span><span class="n">vocabulary</span> <span class="o">=</span> <span class="n">vocabulary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">term_mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_tfidf</span><span class="p">()</span></div>

<div class="viewcode-block" id="TextClassifier.store_text"><a class="viewcode-back" href="../index.html#text_classifier.TextClassifier.store_text">[documentos]</a>    <span class="k">def</span> <span class="nf">store_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">texts</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">replace_texts</span><span class="o">=</span><span class="k">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calcula los vectores de terminos de un texto y los almacena.</span>

<span class="sd">        Nota:</span>
<span class="sd">            Esta funcion usa el vocabulario que ya esta almacenado, es decir,</span>
<span class="sd">            que no se incorporan nuevos terminos. Si se quiere cambiar el</span>
<span class="sd">            vocabulario deben recargarse todos los textos con</span>
<span class="sd">            :func:`~TextClassifier.TextClassifier.reload_texts`</span>
<span class="sd">        Args:</span>
<span class="sd">            texts (list): Una lista de N textos a incorporar.</span>
<span class="sd">            ids (list of str): Una lista de N ids alfanumericos para los textos</span>
<span class="sd">            replace_texts (bool, optional): Indica si deben reemplazarse los</span>
<span class="sd">                textos cuyo id ya este almacenado. Si es False y algun id ya se</span>
<span class="sd">                encuentra almacenado se considera un error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_id_length</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">replace_texts</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Alguno de los ids provistos ya esta en el </span><span class="se">\</span>
<span class="s">                              indice&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
            <span class="n">partial_mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span>
            <span class="c"># Si no hay ids ya guardados solo concateno y los agrego al</span>
            <span class="c"># array self.ids</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">,</span> <span class="n">ids</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">term_mat</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">term_mat</span><span class="p">,</span>
                                               <span class="n">partial_mat</span><span class="p">))</span>
            <span class="c"># Si los hay,</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">oldrows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">,</span> <span class="n">ids</span><span class="p">)</span>
                <span class="n">oldpartial</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">)</span>
                <span class="c"># Actualizo las filas que ya estaban</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">term_mat</span><span class="p">[</span><span class="n">oldrows</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">partial_mat</span><span class="p">[</span><span class="n">oldpartial</span><span class="p">,</span> <span class="p">:]</span>
                <span class="c"># y agrego las que no</span>
                <span class="n">partial_mat</span> <span class="o">=</span> <span class="n">partial_mat</span><span class="p">[</span><span class="o">~</span><span class="n">oldpartial</span><span class="p">,</span> <span class="p">:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">term_mat</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">term_mat</span><span class="p">,</span> <span class="n">partial_mat</span><span class="p">))</span>
                <span class="c"># concateno los viejos ids y los nuevos</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">,</span> <span class="n">ids</span><span class="p">[</span><span class="o">~</span><span class="n">oldpartial</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_tfidf</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_update_tfidf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tfidf_mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">term_mat</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_id_length</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ids</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">,</span> <span class="n">ids</span><span class="p">)):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;Hay ids que son muy largos. Es posible que se hayan </span><span class="se">\</span>
<span class="s">            ingresado textos planos en lugar de ids.&quot;</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Código de módulo</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Búsqueda rápida</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Ir a" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, mec.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
    </div>

    

    
  </body>
</html>